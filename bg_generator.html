<html>
  <head>
    <title>Background Generator</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Open+Sans&family=Play:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.3.1/lib/p5.js"></script>
    <script src="sketch.js"></script>
    <link rel="icon" type="image/png" href="portrait_16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="portrait_32.png" sizes="32x32">
  </head>
  <body>
    <div class='container'>
      <header class="py-1 border-bottom">
        <a href="http://wp.tmdojo.tdk.biz/wordpress/"><img src="dojo.svg" width="160" height="auto"></a>
      </header>
      <div class="alert alert-danger" role="alert" id="ie-alert">
        This site does not work with Internet Explorer. Please use proper browser like Chrome or Edge.
      </div>
      <div class="row py-2">
        <div class="col">
          <div class="card">
            <h3 class="card-header">Virtual background generator</h3>            
            <div class="card-body">
              <p class="card-text">Edit your name and press "Download" button to save your own virtual background image file.</p>
              <p class="card-text">You can use the file with Teams, WebEx, Zoom, etc.</p>
            </div>
          </div>
        </div>
        <div class="col">
          <form>
            <div class="mb-3">
              <label for="first-name" class="form-label">First name</label>
              <input type="text" class="form-control" id="first-name" value="First_name">
            </div>
            <div class="mb-3">
              <label for="last-name" class="form-label">Last name</label>
              <input type="text" class="form-control" id="last-name" value="Last_name">
            </div>
            <div class="mb-3">
              <input type="checkbox" class="form-check-input" id="kindergarten">
              <label for="kindergarten" class="form-check-label">Add TDK Kindergarten logo</label>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Your e-mail</label>
              <input type="email" class="form-control" id="email" value="first.last@tdk.com">
              <div id="emailHelpBlock" class="form-text">
                (Optional) Enter your e-mail address to receive update notifications.
              </div>
            </div>
          </form>
          <button id="download-btn" class="btn btn-primary">Download</button>
        </div>
      </div>
      <div class="row py-2">
        <main class="p-3 bg-light rounded-3">
        </main>
      </div>
    </div>
    <footer class="bg-light text-center text-lg-start border-top">
      <!-- Copyright -->
      <div class="text-center p-3">
        Web app written by:
        <a class="text-dark" href="mailto:shunya.sato@tdk.com">Shunya Sato</a>
      </div>
      <!-- Copyright -->
    </footer>
    <script>
      var baseImg;
      var last_name;
      var first_name;
      var kindergarten;
      var email;
      var btn;
      var reps;

      var textHeight = 150;
      var textHCenter = 1500;
      var vSpacing = 10;

      function preload(){
          baseImg = loadImage("bg_base.png");
      }

      function setup() {
          // https://www.microsoft.com/en-us/microsoft-teams/background-blur
          // For the best experience with custom backgrounds, we recommend uploading images with an aspect ratio of 16:9 and a resolution of at least 1920 x 1080 if possible. The higher the resolution, the better your images will appear.
          var cnv = createCanvas(1920, 1080);
          cnv.style('width', '100%');
          cnv.style('height', 'auto');
          // Internet Explorer 6-11
          var isIE = /*@cc_on!@*/false || !!document.documentMode;
          if (isIE == false){
            var ie_alert = select("#ie-alert");
            ie_alert.style("display", "none");
          }
          last_name = document.getElementById("last-name");
          first_name = document.getElementById("first-name");
          kindergarten = document.getElementById("kindergarten");
          email = document.getElementById("email");
          btn = document.getElementById("download-btn");
          btn.addEventListener("click", btnClicked);
          textAlign(CENTER, CENTER);
      }
        
      function draw() {
          image(baseImg,0,0);
          textFont("Open Sans");
          //textFont("Noto Sans JP");
          fill('#005BAC');
          textSize(textHeight);
          //textSize(textHeight-20); //TODO: adjust size according to the text length
          text(last_name.value, textHCenter, height/2);
          textSize(textHeight);
          text(first_name.value, textHCenter, height/2 - (textHeight + vSpacing));
          if(kindergarten.checked == true){
            textFont("Play");
            textSize(90);
            text("Kindergarten", 360, 650);
          }
      }

      function btnClicked() {
          var datadic = {
              "last_name": last_name.value,
              "first_name": first_name.value,
              "email": email.value,
              "kindergarten": kindergarten.checked
          }
          postData2(datadic);    
          saveCanvas('namecard', 'png');
      }

    </script>
</body>
</html>